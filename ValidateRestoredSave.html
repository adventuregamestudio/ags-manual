<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>validate_restored_save</title>
  <link rel="stylesheet" href="css/normalize.css" />
  <link rel="stylesheet" href="css/main.css" />
  <link href="static/favicon.ico" rel="icon" type="image/x-icon" />
</head>
<body>


  <div class="header-bg"></div>
  <div class="container">
    <header>
      <h1>
        <a href="index.html">
          <img src="static/logo.svg" id="cup" width="48" height="48">
          AGS Manual
        </a>
      </h1>
      <label class="header_input search-box">
        <input type="search" id="search_input" placeholder="Search">
        <label class="toggle-icon" title="Match Case">
          <input type="checkbox" id="citoggle" onclick="citoggle_clicked()">
          <span>Aa</span>
        </label>
        <label class="toggle-icon" title="Match Whole Word">
          <input type="checkbox" id="wwtoggle" onclick="wwtoggle_clicked()" checked="checked">
          <span><u>ab</u></span>
        </label>
      </label>

      <label class="toggle-icon" title="Highlight">
        <input type="checkbox" id="hltoggle" onclick="hltoggle_clicked()" checked="checked">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="24px" height="24px" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="iconify iconify--carbon"><path fill="currentColor" d="M12 15H5a3 3 0 0 1-3-3v-2a3 3 0 0 1 3-3h5V5a1 1 0 0 0-1-1H3V2h6a3 3 0 0 1 3 3zM5 9a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h5V9zm15 14v2a1 1 0 0 0 1 1h5v-4h-5a1 1 0 0 0-1 1z"></path><path fill="currentColor" d="M2 30h28V2Zm26-2h-7a3 3 0 0 1-3-3v-2a3 3 0 0 1 3-3h5v-2a1 1 0 0 0-1-1h-6v-2h6a3 3 0 0 1 3 3Z"></path></svg>
      </label>
      
      <label class="toggle-icon" title="Toggle dark mode">
        <input type="checkbox" checked="checked"  id="dark_mode_toggle">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path fill="currentColor" d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26a5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" /></svg>
      </label>
      
      <label class="mobile-menu">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 32 32" width="24px" fill="currentColor"><path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z" /></svg>
      </label>

      <script src="js/darkmode.js"></script>
      <script src="js/mark.min.js"></script>

      <ul id="search_results"></ul>
    </header>

  <nav>
    <ul>
      <li><a href="genindex.html">Index</a></li>
    </ul>
  </nav>

  <div class="content">
    <article>
      <main>
<section id="validate_restored_save" class="level2">
<h2><a href="#validate_restored_save">validate_restored_save</a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode ags"><code class="sourceCode ags"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>validate_restored_save<span class="op">(</span>RestoredSaveInfo<span class="op">*</span> info<span class="op">)</span></span></code></pre></div>
<p>Starting with version 3.6.2 the engine potentially allows to restore older saves which contents do not directly match the current game. To be precise - it allows to restore saves which have <em>less</em> data of any kind than the current game: less Characters, less GUI, less controls on particular GUI, less script variables, and so forth. But would such saves be restored fully automatically, that would result in unexpected game behavior, and would come unexpected to the game developers.</p>
<p>For that reason we have introduced a function named "validate_restored_save", which you may write in your game script if you would like to support restoring older saves with less data. If you do not plan that in your game, then you do not have to add one.</p>
<p>The purpose of "validate_restored_save" is to receive a struct <a href="RestoredSaveInfo.html"><code>RestoredSaveInfo</code></a> which contains a summary about the save, and lets game developer decide whether to accept or cancel this save.</p>
<p>This function may be called in two cases:</p>
<ul>
<li>when a save is being restored by the engine, and data mismatch was detected;</li>
<li>when <a href="Game.html#gamescansaveslots"><code>Game.ScanSaveSlots</code></a> is called by you.</li>
</ul>
<p>If we take a look at the <code>RestoredSaveInfo</code> struct, most of its properties tell the numbers of different kinds of data: <code>CharacterCount</code>, <code>GUICount</code>, and so on, - they are self-descriptive for the most part.</p>
<p>Besides these there are several properties that have special meaning:</p>
<p><em>RestoredSaveInfo.IsPrescan</em> - tells whether "validate_restored_save" was called as a part of save scanning. This means that no restored data was applied to the game, and only a save summary was gathered for validation.</p>
<p><em>RestoredSaveInfo.HasExtraData</em> and <em>RestoredSaveInfo.HasMissingData</em> - these indicate if the save contains mismatching data.</p>
<p><em>RestoredSaveInfo.Cancel</em> - by setting this value to <code>true</code> or <code>false</code> you decide whether to accept or cancel the save. Note that if there's any data mismatch, then Cancel will be set to <code>true</code> by default: that means that if you do not set it yourself, then the save will be cancelled automatically.</p>
<p><em>RestoredSaveInfo.RetryWithoutComponents</em> - by setting this value to a combination of <a href="StandardEnums.html#savecomponentselection">SaveComponentSelection values</a> you can instruct the engine to reload the same save, only this time it should skip certain types of data completely. This choice may be the last resort when the save is so outdated that some parts of it cannot be applied.</p>
<p>In the most common case in this function you inspect the provided save's summary and set RestoredSaveInfo.Cancel to either <code>true</code> or <code>false</code>, judging by the summary values. What else you do in this function is completely up to you. For example, you may modify certain things in game after restoring an old save. Or you may schedule this for later, when you receive <a href="Globalfunctions_Event.html#on_event"><code>eEventRestoreGame</code></a>.</p>
<p>Following is a relatively simple example of how such function could be implemented:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ags"><code class="sourceCode ags"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">validate_restored_save</span><span class="op">(</span>RestoredSaveInfo<span class="op">*</span> info<span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We do not support saves with extra data.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>info<span class="op">.</span><span class="at">HasExtraData</span><span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        info<span class="op">.</span><span class="at">Cancel</span> = <span class="bu">true</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If there&#39;s no missing data, then simply accept it and return.</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>info<span class="op">.</span><span class="at">HasMissingData</span><span class="op">)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        info<span class="op">.</span><span class="at">Cancel</span> = <span class="bu">false</span><span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now we are dealing with saves with less data than the current game has.</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Let&#39;s suppose that we only let load saves if they have 5+ characters in them.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If they have less - that&#39;s some old WIP game version which we no longer want.</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>info<span class="op">.</span><span class="at">CharacterCount</span> <span class="op">&lt;</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        info<span class="op">.</span><span class="at">Cancel</span> = <span class="bu">true</span><span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set Cancel to false, so that the save gets accepted now.</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    info<span class="op">.</span><span class="at">Cancel</span> = <span class="bu">false</span><span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If this is a &quot;prescan&quot; run, then this save is not getting loaded right away,</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// so we should not upgrade any game data, so return.</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>info<span class="op">.</span><span class="at">IsPrescan</span><span class="op">)</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now we know that this save with less data was loaded into the game.</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Suppose that in the older versions of the game we had character cNPC</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// standing in room 1, but in the newer vesions we need to have it in room 2,</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// so update its location.</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cNPC<span class="op">.</span><span class="at">Room</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        cNPC<span class="op">.</span><span class="at">ChangeRoom</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// etc...</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><em>Compatibility:</em> <code>validate_restored_save</code> is supported by <strong>AGS 3.6.2</strong> and later versions.</p>
<p><em>See also:</em> <a href="RestoredSaveInfo.html"><code>RestoredSaveInfo</code></a>, <a href="Game.html#gamescansaveslots"><code>Game.ScanSaveSlots</code></a></p>
</section>
      <a class="edit-link" href="https://github.com/adventuregamestudio/ags-manual-source/blob/master/ValidateRestoredSave.md" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg> Edit this page</a>
      </main>
      <footer>
        <p>
          <a href="jslicensing.html" data-jslicense="1">Third-party JavaScript licensing</a><br>
          Build: ed75ea05a92de6b9ff5582c5376524816e60c494
        </p>
      </footer>
    </article>
    
    <aside>
<ul>
<li><a href="#validate_restored_save" id="toc-validate_restored_save">validate_restored_save</a></li>
</ul>
    </aside>
  </div>




  </div>
  <script src="js/navigation.js"></script>
  <script src="js/search.js"></script>
  
</body>
</html>
