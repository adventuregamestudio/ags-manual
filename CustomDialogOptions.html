<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Custom dialog options rendering</title>
  <link rel="stylesheet" href="css/normalize.css" />
  <link rel="stylesheet" href="css/main.css" />
  <link href="static/favicon.ico" rel="icon" type="image/x-icon" />
</head>
<body>


  <div class="container">
    <header>
      <label class="toggle-control" for="dark_mode_toggle">
        <input type="checkbox" checked="checked"  id="dark_mode_toggle">
        <span class="control"></span>
      </label>
      <script src="js/darkmode.js"></script>
      <script src="js/mark.min.js"></script>
      <label class="header_input" for="search_input">Search:</label>
      <input type="search" id="search_input">
      <label for="citoggle" class="header_input">Aa</label>
      <input type="checkbox" id="citoggle" onclick="citoggle_clicked()">
      <ul id="search_results"></ul>
    </header>

  <nav>
    <a href="index.html">
      <svg id="cup" width="72" height="48" viewBox="0 0 12 8" preserveAspectRatio="xMidYMid meet">
        <g shape-rendering="crispEdges">
          <rect width="10" height="7" fill="#ffffff" />
          <svg y="1">
            <rect width="12" height="5" fill="#ffffff" />
          </svg>
          <svg x="1">
            <rect width="8" height="8" fill="#ffffff" />
          </svg>
          <svg x="1" y="1">
            <rect width="8" height="5" fill="#2a7fff" />
          </svg>
          <svg x="2" y="6">
            <rect width="6" height="1" fill="#2a7fff" />
          </svg>
          <svg x="9" y="2">
            <rect width="2" height="3" fill="#2a7fff" />
          </svg>
          <svg x="9" y="3">
            <rect width="1" height="1" fill="#ffffff" />
          </svg>
          <svg x="2" y="2">
            <rect width="6" height="3" fill="#0000d4" />
          </svg>
          <svg x="3" y="5">
            <rect width="4" height="1" fill="#0000d4" />
          </svg>
          <svg x="2" y="1">
            <rect width="6" height="1" fill="#ffffff" />
          </svg>
        </g>
      </svg>
    </a>
    <h1>
      <a href="index.html">AGS Manual</a>
    </h1>
    <ul>
      <li><a href="genindex.html">Index</a></li>
    </ul>
<ul>
<li><a href="#custom-dialog-options-rendering"><span>Custom dialog options rendering</span></a>
<ul>
<li><a href="#dialog_options_get_dimensions"><span><code>dialog_options_get_dimensions</code></span></a></li>
<li><a href="#dialog_options_render"><span><code>dialog_options_render</code></span></a></li>
<li><a href="#dialog_options_mouse_click"><span><code>dialog_options_mouse_click</code></span></a></li>
<li><a href="#dialog_options_key_press"><span><code>dialog_options_key_press</code></span></a></li>
<li><a href="#dialog_options_text_input"><span><code>dialog_options_text_input</code></span></a></li>
<li><a href="#dialog_options_repexec"><span><code>dialog_options_repexec</code></span></a></li>
<li><a href="#dialog_options_close"><span><code>dialog_options_close</code></span></a></li>
<li><a href="#dialog_options_get_active"><span><code>dialog_options_get_active</code></span></a></li>
<li><a href="#example-a-classic-mouse-controls"><span>Example A. Classic mouse controls</span></a></li>
<li><a href="#example-b-keyboard-controls"><span>Example B. Keyboard controls</span></a></li>
</ul></li>
</ul>
  </nav>

  <main>
<section id="custom-dialog-options-rendering" class="level2">
<h2><a href="#custom-dialog-options-rendering">Custom dialog options rendering</a></h2>
<p>By default, AGS comes with two types of dialog options -- displaying them using the size and position of an existing GUI, or creating a text window to display the options in.</p>
<p>As of AGS 3.1 and above, if neither of these methods suit you (for example, because you want to use picture-based dialog options, or you want to add scroll arrows), you can now implement the dialog options display yourself in the script.</p>
<p><strong>NOTE:</strong> This topic involves some advanced scripting. If you're just starting out with AGS, please just use one of the built-in dialog option styles for now, and come back to this later when you're comfortable with scripting.</p>
<p>To write your custom dialog options code, you need to add a number of even handlers in your script, taken from the list below. <em>Two of them must be present</em> (<code>dialog_options_get_dimensions</code> and <code>dialog_options_render</code>), but others are optional, so use only those that match your game needs. These function would work somewhat similar to the <a href="Globalfunctions_Event.html">common event handlers</a>, except they are only run whenever the dialog options are on screen.</p>
<p>All of these functions accept <a href="DialogOptionsRenderingInfo.html"><code>DialogOptionsRenderingInfo</code></a> object as a first argument. This object may be used to get and set various properties, including accessing current Dialog object.</p>
<p><strong>NOTE:</strong> These functions don't have to go in the global script; you can put them in any script you like. However, beware that if the functions are present in more than one script they could interfere with each other and cause problems.</p>
<p><strong>COMPATIBILITY NOTE:</strong> The older versions of AGS (pre-3.4.0) were working with somewhat different set of functions. There was no <code>dialog_options_repexec</code> and <code>dialog_options_key_press</code>, but you had to add <code>dialog_options_get_active</code> function instead in which you'd set an active dialog option (or none) on each game update, for example, depending on the cursor position. Mouse clicks were processed by the engine, and if an active option was set in <code>dialog_options_get_active</code> then it was run automatically. There is a compatibility switch in the General Settings called "Use old-style dialog options rendering API" that toggles between the old and new behavior. If you have imported older project and want to keep old dialog option scripts, then make sure it's enabled. If you wish to update your game to the new behavior, then turn it off.</p>
<p><strong>IMPORTANT:</strong> All of the Custom Dialog functions run on the non-blocking thread. That means that you should not make any blocking calls, such as Character.Say, Wait or Display within them, as they may not behave correctly.</p>
<hr />
<section id="dialog_options_get_dimensions" class="level3">
<h3><a href="#dialog_options_get_dimensions"><code>dialog_options_get_dimensions</code></a></h3>
<pre><code>dialog_options_get_dimensions(DialogOptionsRenderingInfo *info)
</code></pre>
<p>This is the first function that will be called before dialog options are shown. It is meant to find out which part of the screen you will be drawing onto. Do that by setting the X, Y, Width and Height properties of the <code>info</code> struct. Only when the width and height are greater than 0 will the custom dialog system be activated.</p>
<p><strong>NOTE:</strong> you may also use this function to set other things up, not only <code>DialogOptionsRenderingInfo</code>.</p>
<hr />
</section>
<section id="dialog_options_render" class="level3">
<h3><a href="#dialog_options_render"><code>dialog_options_render</code></a></h3>
<pre><code>dialog_options_render(DialogOptionsRenderingInfo *info)
</code></pre>
<p>This function is called right before the dialog options are shown or updated on screen. The <code>info</code> struct will supply a <a href="DrawingSurface.html"><code>DrawingSurface</code></a> which may be accessed using <code>info.Surface</code> property, and which you may draw upon.</p>
<hr />
</section>
<section id="dialog_options_mouse_click" class="level3">
<h3><a href="#dialog_options_mouse_click"><code>dialog_options_mouse_click</code></a></h3>
<pre><code>dialog_options_mouse_click(DialogOptionsRenderingInfo *info, MouseButton button)
</code></pre>
<p>This function is called if the player clicks the mouse anywhere on dialog options. It corresponds to the regular <a href="Globalfunctions_Event.html#on_mouse_click"><code>on_mouse_click</code></a>. You might want to use this to process clicks on dialog options, and also on some custom elements like scroll arrows, for example.</p>
<hr />
</section>
<section id="dialog_options_key_press" class="level3">
<h3><a href="#dialog_options_key_press"><code>dialog_options_key_press</code></a></h3>
<pre><code>dialog_options_key_press(DialogOptionsRenderingInfo *info, eKeyCode keycode, int mod)
</code></pre>
<p>This function is called if the player presses any key while custom dialog options are shown on screen. It corresponds to the regular <a href="Globalfunctions_Event.html#on_key_press"><code>on_key_press</code></a>, and you can use this to implement key-controlled selection of dialog option, for example.</p>
<p><strong>Compatibility:</strong> the optional <code>mod</code> argument is supported since <strong>AGS 3.6.0</strong>. Please refer to the <a href="Globalfunctions_Event.html#on_key_press"><code>on_key_press</code></a> description for details.</p>
<hr />
</section>
<section id="dialog_options_text_input" class="level3">
<h3><a href="#dialog_options_text_input"><code>dialog_options_text_input</code></a></h3>
<pre><code>dialog_options_text_input(DialogOptionsRenderingInfo *info, int ch)
</code></pre>
<p>This function is called if the player's key presses form a printable character. It corresponds to the regular <a href="Globalfunctions_Event.html#on_text_input"><code>on_text_input</code></a>, and you can use this to handle a custom text input in your dialog options.</p>
<p><strong>Compatibility:</strong> Supported by AGS 3.6.0 and above. <code>dialog_options_text_input</code> will only work if you have "Use old-style key handling" option disabled in the "General Settings".</p>
<hr />
</section>
<section id="dialog_options_repexec" class="level3">
<h3><a href="#dialog_options_repexec"><code>dialog_options_repexec</code></a></h3>
<pre><code>dialog_options_repexec(DialogOptionsRenderingInfo *info)
</code></pre>
<p>This function works similar to a general <a href="Globalfunctions_Event.html#repeatedly_execute"><code>repeatedly_execute</code></a> function, but is called only while the dialog options are shown on the screen. You may use this to update the dialog options state, for example, for determining which option the mouse is currently hovering over, or scripting timed actions.</p>
<hr />
</section>
<section id="dialog_options_close" class="level3">
<h3><a href="#dialog_options_close"><code>dialog_options_close</code></a></h3>
<pre><code>dialog_options_close(DialogOptionsRenderingInfo *info)
</code></pre>
<p>This function will be called right before the dialog options are removed from the screen. This is a place to perform a "cleanup" in case you need to dispose temporary resources (like dynamic sprites), hide GUIs, stop sounds, and so forth.</p>
<p><strong>NOTE:</strong> this is not the same as the end of the current dialog. Dialog options may be shown and hidden multiple times during the dialog, every time the game lets player to choose a dialog option.</p>
<p><strong>Compatibility:</strong> Supported by AGS 3.6.0 and above.</p>
<hr />
</section>
<section id="dialog_options_get_active" class="level3">
<h3><a href="#dialog_options_get_active"><code>dialog_options_get_active</code></a></h3>
<pre><code>dialog_options_get_active(DialogOptionsRenderingInfo *info)
</code></pre>
<p><em>Compatibility:</em> <code>dialog_options_get_active</code> is a deprecated function that works only if you have "Use old-style dialog options rendering API" enabled in General Settings. In a modern script use <code>dialog_options_repexec</code> instead.</p>
<p>This function is called as the player moves the mouse around the screen. This needs to work out which option the mouse is currently hovering over, so that AGS knows which option to process if the player clicks the mouse button. Use it to set <code>info.ActiveOptionID</code> property, or do any other changes.</p>
<hr />
</section>
<section id="example-a-classic-mouse-controls" class="level3">
<h3><a href="#example-a-classic-mouse-controls">Example A. Classic mouse controls</a></h3>
<pre><code>int dlg_opt_color = 14;
int dlg_opt_acolor = 13;
int dlg_opt_ncolor = 4;

function dialog_options_get_dimensions(DialogOptionsRenderingInfo *info)
{
  // Create a 200x200 dialog options area at (50,100)
  info.X = 50;
  info.Y = 100;
  info.Width = 200;
  info.Height = 200;
  // Enable alpha channel for the drawing surface
  info.HasAlphaChannel = true;
  // Put the text parser at the bottom (if enabled)
  info.ParserTextBoxX = 10;
  info.ParserTextBoxY = 160;
  info.ParserTextBoxWidth = 180;
}

function dialog_options_render(DialogOptionsRenderingInfo *info)
{
  info.Surface.Clear(dlg_opt_color);
  int ypos = 0;
  // Render all the options that are enabled
  for (int i = 1; i &lt;= info.DialogToRender.OptionCount; i++)
  {
    if (info.DialogToRender.GetOptionState(i) == eOptionOn)
    {
      if (info.ActiveOptionID == i)
        info.Surface.DrawingColor = dlg_opt_acolor;
      else
        info.Surface.DrawingColor = dlg_opt_ncolor;

      info.Surface.DrawStringWrapped(5, ypos, info.Width - 10,
              eFontNormal, eAlignLeft, info.DialogToRender.GetOptionText(i));
      ypos += GetTextHeight(info.DialogToRender.GetOptionText(i), eFontNormal, info.Width - 10);
    }
  }
}

function dialog_options_repexec(DialogOptionsRenderingInfo *info)
{
  info.ActiveOptionID = 0;
  if (mouse.y &lt; info.Y || mouse.y &gt;= info.Y + info.Height ||
      mouse.x &lt; info.X || mouse.x &gt;= info.X + info.Width)
  {
    return; // return if the mouse is outside UI bounds
  }

  int ypos = 0;
  // Find the option that corresponds to where the mouse cursor is
  for (int i = 1; i &lt;= info.DialogToRender.OptionCount; i++)
  {
    if (info.DialogToRender.GetOptionState(i) == eOptionOn)
    {
      ypos += GetTextHeight(info.DialogToRender.GetOptionText(i), eFontNormal, info.Width - 10);
      if ((mouse.y - info.Y) &lt; ypos)
      {
        info.ActiveOptionID = i;
        return;
      }
    }
  }
}

function dialog_options_mouse_click(DialogOptionsRenderingInfo *info, MouseButton button)
{
  if (info.ActiveOptionID &gt; 0)
    info.RunActiveOption();
}
</code></pre>
<p>The examples above are slightly naive; in reality you would probably want to track the Y position of each option in a variable to save having to continually scan through all the options.</p>
<hr />
</section>
<section id="example-b-keyboard-controls" class="level3">
<h3><a href="#example-b-keyboard-controls">Example B. Keyboard controls</a></h3>
<pre><code>int dlg_opt_color = 14;
int dlg_opt_acolor = 13;
int dlg_opt_ncolor = 4;

function dialog_options_get_dimensions(DialogOptionsRenderingInfo *info)
{
  // Create a 200x200 dialog options area at (50,100)
  info.X = 50;
  info.Y = 100;
  info.Width = 200;
  info.Height = 200;
  info.ActiveOptionID = 1; // set to first option
}

function dialog_options_render(DialogOptionsRenderingInfo *info)
{
  info.Surface.Clear(dlg_opt_color);
  int ypos = 0;
  // Render all the options that are enabled
  for (int i = 1; i &lt;= info.DialogToRender.OptionCount; i++)
  {
    if (info.DialogToRender.GetOptionState(i) == eOptionOn)
    {
      if (info.ActiveOptionID == i)
        info.Surface.DrawingColor = dlg_opt_acolor;
      else
        info.Surface.DrawingColor = dlg_opt_ncolor;

      info.Surface.DrawStringWrapped(5, ypos, info.Width - 10,
          eFontNormal, eAlignLeft, info.DialogToRender.GetOptionText(i));
      ypos += GetTextHeight(info.DialogToRender.GetOptionText(i), eFontNormal, info.Width - 10);
    }
  }
}

function dialog_options_key_press(DialogOptionsRenderingInfo *info, eKeyCode keycode, int mod)
{
  if (keycode == eKeyUpArrow)
  {
    // check all options upwards until found an active one
    for (int next_opt = info.ActiveOptionID - 1; next_opt &gt;= 1; next_opt--)
    {
      if (info.DialogToRender.GetOptionState(next_opt) == eOptionOn)
      {
        info.ActiveOptionID = next_opt;
        break;
      }
    }
  }
  else if (keycode == eKeyDownArrow)
  {
    // check all options downwards until found an active one
    for (int next_opt = info.ActiveOptionID + 1; next_opt &lt;= info.DialogToRender.OptionCount; next_opt++)
    {
      if (info.DialogToRender.GetOptionState(next_opt) == eOptionOn)
      {
        info.ActiveOptionID = next_opt;
        break;
      }
    }
  }
  else if (keycode == eKeyReturn || keycode == eKeySpace)
  {
    info.RunActiveOption();
  }
}
</code></pre>
</section>
</section>
  </main>


  <footer>
    <p>
      <a href="jslicensing.html" data-jslicense="1">Third-party JavaScript licensing</a><br>
      Build: 826452ec0fbae1064b21078a69d2de4eda2a67e8
    </p>
  </footer>

  <script src="js/search.js"></script>
  </div>
</body>
</html>
